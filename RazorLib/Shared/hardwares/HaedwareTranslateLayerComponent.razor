@using RazorLib.Shared.html
@using RazorLib.Shared.navs.pills
@using SharedLib.IServices;
@using SharedLib;

@inherits BlazorBusyComponentBaseModel

@inject IHardwaresService _hardwares

<PillsSetComponent>
    <PillComponent Tooltip="Рендеринг" Title="Рендеринг">
        <HtmlRootTranslatorComponent @ref="ref1" Html="@html" />
    </PillComponent>
    <PillComponent Tooltip="Парсинг исходного HTML в DOM" Title="Дерево">
        <HtmlTreeComponent Html="@html" />
    </PillComponent>
    <PillComponent Tooltip="Исходный HTML" Title="Исходники">
        <HtmlShowComponent Html="@html" />
    </PillComponent>
</PillsSetComponent>
<ShowMessagesComponent @ref="showMessages" />
@code {
    [CascadingParameter, EditorRequired]
    public int Id { get; set; }

    ShowMessagesComponent? showMessages;
    string? html;

    HtmlRootTranslatorComponent? ref1;

    async Task GetData()
    {
        if (Id <= 0)
            return;

        IsBusyProgress = true;
        HttpResponseModel rest = await _hardwares.GetHardwareHtmlPage(new HardvareGetRequestModel() { HardwareId = Id });

        if (!rest.IsSuccess)
        {
            showMessages?.ShowMessages(rest.Messages);
            return;
        }

        html = rest.TextPayload;
        IsBusyProgress = false;

        ref1?.StateHasChangedCall(html);
    }

    protected override async Task OnInitializedAsync() => await GetData();
}